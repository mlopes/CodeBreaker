#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

class Main
{
    private $codebreaker;
    private $formatter;

    public function __construct(Codebreaker $codebreaker, Formatter $formatter)
    {
        $this->codebreaker = $codebreaker;
        $this->codebreaker->setSecret((string)rand(1000, 9999));

        $this->formatter = $formatter;
    }

    public function run()
    {
        $guessResult = $this->takeGuess();

        if ($guessResult !== '++++') {
            echo $this->formatter->format($guessResult);
            return $this->run();
        }

        echo $this->formatter->format($guessResult);
        echo("Well done!!!\n");
    }

    private function takeGuess()
    {
        $guess = readline('Guess what 4 digit number I\'m thing of? ');
        $guessResult = $this->codebreaker->takeGuess($guess);
        return $guessResult;
    }

}


$codeBreaker = new NumberCodeBreaker();
$formatter = new ColourFormatter();

$codebreaker = new Main($codeBreaker, $formatter);
$codebreaker->run();
